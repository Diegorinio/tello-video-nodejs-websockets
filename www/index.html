<!DOCTYPE html>
<html>
<head>
	<title>Tello Video Stream Example</title>
	<link rel='stylesheet' href='./main.css'>
</head>
<body>
	<canvas height="500" width="500" id="video-canvas"></canvas>
	<script type="text/javascript" src="jsmpeg.min.js"></script>
	<script type="text/javascript">
		var ws = new WebSocket('ws://localhost:8000/')
		var canvas = document.getElementById('video-canvas');
		var url = 'ws://'+document.location.hostname+':3001/stream';
		console.log(url)
		var player = new JSMpeg.Player(url, {canvas: canvas});
		var gl = canvas.getContext("webgl")
		window.addEventListener('keydown', (event)=>{
				switch(event.keyCode)
				{
					case 39:
						console.log("right")
						ws.send("rotate-right")
						break;
					case 37:
						console.log("left")
						ws.send("rotate-left")
						break
					case 80:
						ws.send("takeoff")
						console.log("takeoff")
						break;
					case 16:
						ws.send("land")
						break;
					case 87:
						ws.send("forward")
					case 83:
						ws.send("backward")
						break
					case 65:
						ws.send("left")
						console.log("left")
						break
					case 68:
						ws.send("right")
						console.log("right")
						break
					case 38:
						ws.send("up")
						console.log('up')
						break
					case 40:
						ws.send("down")
						console.log("down")
						break
					case 53:
						ws.send("flyaway")
						break
					
				}
			})
		ws.onmessage = (msg)=>{
			const content = JSON.parse(msg.data)
			// console.log(content)
			document.querySelector('.battery-state').innerHTML = content.battery
			document.querySelector('.temp-state').innerHTML = `${content.temperature.low} / ${content.temperature.high}`
			document.querySelector('.h-slider').value = content.heigh
			document.querySelector('.h-value').innerHTML = content.heigh
		}
		ws.onopen = ()=>
		{
			console.log('open')
		}
	</script>
	<div class='drone-stats'>
		<div class='drone-states'>
			<span>battery:</span><p class='battery-state'>battery</p>
			<span>temp:</span><p class='temp-state'>temp</p>
		</div>
		<div class='drone-height'>
			<input type='range' min="0" max="1000" value='0' class='h-slider' id='h-range' orient='vertical'>
			<p>Height</p>
			<p class='h-value'></p>
		</div>
	</div>
</body>
</html>
